<!DOCTYPE html>
<html lang="es" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Ramo de Tulipanes Rojos</title>
<meta name="description" content="Ramo animado de tulipanes rojos con efectos y contacto rápido por WhatsApp.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ff6b3c">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000000">
<link rel="preconnect" href="https://wa.me">
<link rel="dns-prefetch" href="https://wa.me">
<link rel="dns-prefetch" href="https://web.whatsapp.com">
<link rel="manifest" href="manifest.webmanifest">
<link rel="icon" type="image/svg+xml" href="favicon.svg">
<link rel="apple-touch-icon" href="icons/icon-192.png">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="color-scheme" content="dark light">
<style>
/* ============ ROOT & TOKENS ============ */
:root{
  --c-bg:#000;
  --c-bg-alt:#0d0d10;
  --c-accent:#ff6b3c;
  --c-accent-2:#df4010;
  --c-accent-3:#ff874f;
  --c-text:#ffdd00;
  --c-text-soft:#ffe680;
  --c-surface:rgba(255,255,255,.05);
  --c-border:rgba(255,255,255,.12);
  --shadow-elev:0 8px 26px rgba(223,64,16,.28),0 0 14px -4px rgba(255,140,90,.25);
  --space:1rem;
  --radius:18px;
  --easing:cubic-bezier(.4,0,.2,1);
  --btn-h:clamp(46px,12vmin,74px);
  --fs-title:clamp(1.85rem,4.6vmin,3.05rem);
  --fs-sub:clamp(1.15rem,3.5vmin,2.2rem);
  --tap:60px;
  --ring:0 0 0 3px rgba(255,107,60,.55);
  --trans-fast:.18s;
  --phone-raw:"4793070486";
  --phone-country:"52";
  --vh:1vh; /* se actualiza en JS */
  /* Gradientes reutilizados */
  --g-petal-large:radial-gradient(circle at 30% 25%,rgba(255,230,230,1) 0%,rgba(255,140,140,.9) 10%,rgba(255,140,140,0) 30%),
    radial-gradient(circle at 70% 75%,rgba(255,255,255,.18) 0%,rgba(255,255,255,0) 35%),
    linear-gradient(180deg,#ff4d4d 0%,#c30f0f 65%,#7a0404 100%);
  --g-petal-small:radial-gradient(circle at 30% 20%,rgba(255,210,210,1) 0%,rgba(255,110,110,.95) 20%,rgba(255,110,110,0) 45%),linear-gradient(180deg,#ff6b6b 0%,#b30b0b 70%);
  --g-center:radial-gradient(circle at 30% 30%,#ffd79a 0%,#ff9a4a 30%,#7a2000 65%,#330800 100%);
}
@media (prefers-color-scheme:light){
  :root{
    --c-bg:#fff;
    --c-bg-alt:#faf9f8;
    --c-text:#c43100;
    --c-text-soft:#d24f1b;
    --c-surface:rgba(0,0,0,.04);
    --c-border:rgba(0,0,0,.08);
    --shadow-elev:0 4px 18px rgba(223,64,16,.20),0 0 10px -2px rgba(223,64,16,.25);
  }
  body{color:var(--c-text);background:linear-gradient(#fff,#ffe9e0);}
  h1,h2{text-shadow:none;}
}

/* ============ RESET ============ */
*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;}
body{
  min-height:calc(var(--vh)*100);
  background:var(--c-bg);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  color:var(--c-text);
  -webkit-font-smoothing:antialiased;
  text-rendering:optimizeLegibility;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-end;
  overflow:hidden;
  overscroll-behavior-y:none;
  scrollbar-width:none;
}
body.hide-overflow{overflow:hidden;}
::selection{background:var(--c-accent-2);color:#fff;}
/* Focus */
:focus-visible{outline:none;box-shadow:var(--ring);border-radius:8px;}
/* Motion reduction */
@media (prefers-reduced-motion:reduce){
  *{animation-duration:.001ms!important;animation-iteration-count:1!important;transition:none!important;scroll-behavior:auto!important;}
  .shooting-stars,.flower__light,#confetti{display:none!important;}
}

/* ============ BACKGROUND LAYERS ============ */
.night{
  position:fixed;inset:0;
  background:
    radial-gradient(circle at 30% 15%,rgba(255,120,40,.18),transparent 55%),
    radial-gradient(ellipse at bottom,var(--c-bg-alt),var(--c-bg) 70%),
    linear-gradient(140deg,#0b0f17,#1a0500 60%,#280400);
  filter:blur(.3vmin) saturate(1.15);
  z-index:0;pointer-events:none;
}

/* Stars */
.shooting-stars{position:fixed;inset:0;pointer-events:none;z-index:1;}
.shooting-star{
  position:absolute;width:3px;height:3px;border-radius:50%;
  background:#fff;box-shadow:0 0 6px 2px rgba(255,255,255,.8);
  opacity:0;animation:shoot 3.2s linear infinite;
  will-change:transform,opacity;
}
.shooting-star::before{
  content:"";position:absolute;top:50%;right:0;transform:translateY(-50%);
  width:0;height:2px;
  background:linear-gradient(90deg,rgba(255,255,255,0),#fff);
  animation:tail 3.2s linear infinite;
}
@keyframes shoot{
  0%{opacity:0;transform:translateX(0) translateY(0) rotate(45deg)}
  10%,85%{opacity:1}
  100%{opacity:0;transform:translateX(115vw) translateY(50vh) rotate(12deg)}
}
@keyframes tail{0%{width:0}30%{width:90px}100%{width:0}}

/* ============ HEADERS ============ */
header{
  position:fixed;top:calc(env(safe-area-inset-top,0) + 3.5%);
  left:50%;transform:translateX(-50%);
  text-align:center;z-index:10;pointer-events:none;
  max-width:92vw;
}
h1{
  font-size:var(--fs-title);
  line-height:1.05;
  background:linear-gradient(90deg,#ffd34d,#fff,#ffd34d);
  background-clip:text;
  -webkit-background-clip:text;
  color:transparent;
  text-shadow:0 0 .8vmin rgba(255,221,0,.6);
  animation:fadeIn 2s .35s forwards;
  opacity:0;
}
h2{
  font-size:var(--fs-sub);
  font-weight:500;
  margin-top:.45em;
  letter-spacing:.5px;
  text-shadow:0 0 .8vmin rgba(255,221,0,.45);
  animation:fadeIn 2.1s 1.2s forwards;
  opacity:0;
}
@keyframes fadeIn{to{opacity:1}}

/* ============ MAIN BUTTON ============ */
#showRamoButton{
  position:fixed;
  left:50%;bottom:clamp(9vmin,env(safe-area-inset-bottom)+8vmin,16vmin);
  transform:translateX(-50%);
  display:inline-flex;align-items:center;justify-content:center;
  gap:.7rem;
  min-width:clamp(230px,64vw,440px);
  height:var(--btn-h);
  padding:0 clamp(1.3rem,5.5vmin,3.2rem);
  border:none;
  border-radius:999px;
  background:linear-gradient(135deg,var(--c-accent),var(--c-accent-2));
  color:#fff;
  font-size:clamp(1rem,2.4vmin,1.5rem);
  font-weight:700;
  cursor:pointer;
  box-shadow:var(--shadow-elev);
  transition:transform var(--trans-fast),box-shadow var(--trans-fast),opacity .3s;
  backdrop-filter:blur(8px) saturate(1.1);
  -webkit-tap-highlight-color:transparent;
  z-index:90;
  touch-action:manipulation;
}
#showRamoButton:hover{transform:translate(-50%,-6px) scale(1.02);}
#showRamoButton:active{transform:translate(-50%,-2px) scale(.97);opacity:.9;}
#showRamoButton.btn-compact{bottom:clamp(4vmin,env(safe-area-inset-bottom)+3vmin,10vmin);min-width:68%;}

/* Scroll shrink (cuando usuario desplaza) */
body.scrolled #showRamoButton{
  min-width:64px;
  padding:0 1.3rem;
  font-size:.95rem;
  letter-spacing:.4px;
  backdrop-filter:blur(10px) saturate(1.6);
}

/* Low power mode (clase) */
.low-power .shooting-stars,
.low-power .flower__light,
.low-power #confetti{display:none!important;}
.low-power #showRamoButton{background:linear-gradient(135deg,#444,#222);box-shadow:0 4px 14px rgba(0,0,0,.45);}

/* ============ ACTION SHEET ============ */
.action-sheet{
  position:fixed;left:50%;bottom:0;
  transform:translate(-50%,105%);
  width:min(94%,480px);
  background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.03));
  border:1px solid var(--c-border);
  border-bottom:0;
  border-top-left-radius:24px;
  border-top-right-radius:24px;
  padding:1.15rem 1.1rem 1.2rem;
  box-shadow:0 -4px 26px -8px rgba(0,0,0,.6);
  backdrop-filter:blur(18px) saturate(1.4);
  display:grid;gap:.9rem;
  grid-template-rows:auto auto auto;
  opacity:0;pointer-events:none;
  transition:transform .55s var(--easing),opacity .38s;
  z-index:95;
}
.action-sheet.visible{transform:translate(-50%,0);opacity:1;pointer-events:auto;}
.action-sheet__title{
  font-size:clamp(.85rem,1.9vmin,1.1rem);
  text-align:center;
  color:#fff;
  letter-spacing:.6px;
  font-weight:600;
}
.action-row{display:flex;gap:.75rem;}
.action-sheet button{
  flex:1;
  border:none;
  border-radius:15px;
  padding:.95rem clamp(.6rem,1.8vmin,1.4rem);
  font-size:clamp(.85rem,1.9vmin,1.05rem);
  font-weight:600;
  cursor:pointer;
  display:inline-flex;
  align-items:center;justify-content:center;
  letter-spacing:.35px;
  transition:transform var(--trans-fast),box-shadow .25s,opacity .25s;
  min-height:56px;
  position:relative;
  overflow:hidden;
}
.action-sheet button:active{transform:scale(.95);}
.btn-whatsapp{background:#25D366;color:#fff;box-shadow:0 6px 18px rgba(37,211,102,.25);}
.btn-call{background:linear-gradient(135deg,var(--c-accent),var(--c-accent-2));color:#fff;box-shadow:0 6px 18px rgba(223,64,16,.3);}
.btn-close{background:rgba(255,255,255,.12);color:#fff;min-width:30%;font-weight:500;}
.btn-neutral{background:#444;color:#fff;}

/* ============ TOAST ============ */
.mini-toast{
  position:fixed;left:50%;top:calc(env(safe-area-inset-top)+12vmin);
  transform:translate(-50%,-16vmin);
  background:rgba(0,0,0,.65);
  color:#fff;
  padding:.7rem 1.15rem;
  border-radius:12px;
  font-size:.8rem;
  letter-spacing:.5px;
  opacity:0;pointer-events:none;
  transition:transform .4s var(--easing),opacity .4s;
  z-index:140;
  max-width:70ch;
  backdrop-filter:blur(6px) saturate(1.4);
}
.mini-toast.show{transform:translate(-50%,0);opacity:1;}

/* ============ CANVAS CONFETTI ============ */
#confetti{position:fixed;inset:0;pointer-events:none;z-index:120;mix-blend-mode:plus-lighter;}

/* ============ FLOWERS (mantiene tus estilos base con refinamientos) ============ */
/* Posicionamos fijo para que siempre se vean saliendo desde la parte inferior */
/* ============ FLOWERS CLEAN ============ */
.flowers{
  position:fixed;
  left:50%;bottom:0;
  transform:translateX(-50%) scale(.78);
  width:100%;max-width:1300px;
  z-index:15;
  pointer-events:none;
  transition:transform .7s var(--easing),filter .7s var(--easing);
  will-change:transform;
  contain:layout paint;
  overflow:visible;
  transform-origin:bottom center;
}
.flowers.flourish{transform:translateX(-50%) scale(.84) translateY(-1.5vmin);filter:drop-shadow(0 12px 28px rgba(0,0,0,.55));}
.flower{position:absolute;bottom:8vmin;transform-origin:bottom center;z-index:40;}

.flower__leafs{position:relative;animation:blooming-flower 2s backwards;}
.flower__leafs::after{
  content:"";position:absolute;left:0;top:0;transform:translate(-50%,-100%);
  width:8vmin;height:8vmin;background:rgba(255,80,80,.9);filter:blur(8vmin);mix-blend-mode:screen;
}
.flower__leaf{position:absolute;bottom:0;left:50%;width:9vmin;height:15vmin;
  background:var(--g-petal-large);
  border-radius:50% 50% 40% 40%/60% 60% 40% 40%;
  transform-origin:bottom center;
  opacity:.98;
  border:1.2px solid rgba(195,15,15,.9);
  box-shadow:0 0 .55vmin rgba(255,80,80,.15),inset 0 -.9vmin 1.2vmin rgba(0,0,0,.25);
  background-blend-mode:normal,screen,multiply;
  z-index:45;
}
.flower__leaf--1{transform:translate(-50%,-5%) rotate(-22deg);z-index:1}
.flower__leaf--2{transform:translate(-50%,-5%) rotate(22deg);z-index:1}
.flower__leaf--3{transform:translate(-50%,-10%) rotate(0);z-index:2}
.flower__leaf--4,.flower__leaf--5,.flower__leaf--6{
  width:7vmin;height:12vmin;
  background:var(--g-petal-small);
  border:1px solid rgba(220,80,80,.9);opacity:.96;
  border-radius:50% 50% 45% 45%/65% 65% 35% 35%;
  box-shadow:0 0 .5vmin rgba(255,140,140,.13),inset 0 -.6vmin .9vmin rgba(0,0,0,.2);
  z-index:3;
}
.flower__leaf--4{transform:translate(-50%,-8%) rotate(-10deg)}
.flower__leaf--5{transform:translate(-50%,-8%) rotate(10deg)}
.flower__leaf--6{transform:translate(-50%,-12%) rotate(0)}
.flower__center{
  position:absolute;left:-2vmin;top:-2vmin;width:4vmin;height:4vmin;border-radius:50%;
  background:var(--g-center);
  border:1.5px solid rgba(255,160,90,.9);
  box-shadow:inset 0 -.4vmin .6vmin rgba(0,0,0,.35),0 0 .6vmin rgba(255,120,60,.12);
  z-index:4;
}
.flower__line{
  height:60vmin;width:2vmin;
  background-image:linear-gradient(to top,transparent 10%,#2d5016 40%,#4a7c23 70%,#6b8e23 100%);
  box-shadow:inset 0 0 2px rgba(0,0,0,.5),0 0 .4vmin rgba(0,0,0,.15);
  animation:grow-flower-tree 4s backwards;
  z-index:30;
}
.flower__line__leaf{--w:8vmin;--h:calc(var(--w)+3vmin);position:absolute;top:20%;left:90%;width:var(--w);height:var(--h);
  border-top-right-radius:var(--h);border-bottom-left-radius:var(--h);
  background-image:linear-gradient(to top,rgba(45,80,22,.6),#4a7c23,#6b8e23);
  box-shadow:inset 0 0 1vmin rgba(0,0,0,.3);
}
.flower__line__leaf--1{transform:rotate(70deg) rotateY(30deg)}
.flower__line__leaf--2{top:45%;transform:rotate(70deg) rotateY(30deg)}
.flower__line__leaf--3,.flower__line__leaf--4{
  border-top-right-radius:0;border-bottom-left-radius:0;border-top-left-radius:var(--h);border-bottom-right-radius:var(--h);
  left:-460%;top:12%;transform:rotate(-70deg) rotateY(30deg);
}
.flower__line__leaf--4{top:40%}
.flower__light{
  position:absolute;bottom:0;width:.8vmin;height:.8vmin;background:#ffdd00;
  border-radius:50%;filter:blur(.1vmin);
  animation:tulip-light 6s linear infinite backwards;
  box-shadow:0 0 1vmin rgba(255,221,0,.8);
}
.flower__light:nth-child(odd){background:#ffaa00;}
@keyframes tulip-light{
  0%{opacity:0;transform:translateY(0) rotate(0deg)}
  20%{opacity:1;transform:translateY(-3vmin) translateX(-1vmin) rotate(45deg)}
  40%{transform:translateY(-8vmin) translateX(1vmin) rotate(90deg)}
  60%{transform:translateY(-12vmin) translateX(-1vmin) rotate(135deg)}
  80%{transform:translateY(-16vmin) translateX(2vmin) rotate(180deg);opacity:.5}
  100%{transform:translateY(-25vmin) rotate(225deg);opacity:0}
}
@keyframes grow-flower-tree{0%{height:0;border-radius:1vmin}}
@keyframes blooming-flower{
  0%{transform:scale(0)}
  100%{transform:scale(1)}
}

.ramo{
  position:absolute;bottom:-18vmin;left:50%;transform:translateX(-50%);
  opacity:0;pointer-events:none;transition:opacity 1.1s var(--easing);
  z-index:5;
  will-change:opacity;
}
.ramo--visible{opacity:1;}
.ramo img{
  width:50vmin;max-width:520px;height:auto;display:block;
  user-select:none;
  pointer-events:none;
  aspect-ratio:1/1;
  image-rendering:optimizeQuality;
}

/* ============ NUEVO: Layout de 3 flores + 1 media (capullo) ============ */
/* Reajuste horizontal para centrarlas mejor sobre el ramo */
.flower--1{left:50%;transform:translate(-32vmin,0) scale(.95);}
.flower--2{left:50%;transform:translate(-11vmin,0) scale(1);} /* central izquierda */
.flower--3{left:50%;transform:translate(11vmin,0) scale(.98);}  /* central derecha */
.flower--half{left:50%;transform:translate(30vmin,4vmin) scale(.62);} /* capullo */

/* Resalta la flor central (puedes mover a otra) */
.flower--2 .flower__center{
  animation:pulse-center 3.2s ease-in-out infinite;
  box-shadow:
    0 0 1.2vmin rgba(255,150,70,.65),
    inset 0 -.4vmin .6vmin rgba(0,0,0,.4);
}
@keyframes pulse-center{
  0%{filter:brightness(1) saturate(1);transform:scale(1);}
  50%{filter:brightness(1.25) saturate(1.15);transform:scale(1.08);}
  100%{filter:brightness(1) saturate(1);transform:scale(1);}
}

/* Capullo (media flor) – oculta pétalos grandes y acorta tallo */
.flower--half .flower__leaf--1,
.flower--half .flower__leaf--2,
.flower--half .flower__leaf--3{display:none;}
.flower--half .flower__leaf--4,
.flower--half .flower__leaf--5,
.flower--half .flower__leaf--6{
  height:10vmin;
  background:linear-gradient(180deg,#ff5a5a 0%,#a50909 75%);
  border-color:#b81818;
  filter:brightness(.95);
}
.flower--half .flower__line{height:42vmin;}
.flower--half .flower__light{display:none;} /* menos luces en el capullo */

/* Ajusta z-index para que las flores aparezcan sobre el ramo */
.ramo{z-index:5;}
.flowers{z-index:15;}

/* ============ RESPONSIVE ============ */
@media (max-width:850px){
  .flowers{transform:scale(.6);}
  .ramo img{width:54vmin;}
}
@media (max-width:620px){
  .flowers{transform:scale(.54);}
  #showRamoButton{font-size:clamp(1rem,4.4vmin,1.55rem);}
}
@media (max-width:480px){
  .flowers{transform:scale(.5);}
  h1{font-size:clamp(1.7rem,7.2vmin,2.5rem)}
  h2{font-size:clamp(1.05rem,5.1vmin,1.85rem)}
  #showRamoButton{width:88%;}
}
@media (max-height:640px){
  #showRamoButton{bottom:clamp(4vmin,env(safe-area-inset-bottom)+3vmin,12vmin);}
}

/* ============ UTILS ============ */
.visually-hidden{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0 0 0 0);white-space:nowrap;border:0;}
.toggle-low-power{
  position:fixed;right:clamp(.6rem,2vmin,1rem);top:clamp(.6rem,2vmin,1rem);
  z-index:120;
  background:var(--c-surface);
  border:1px solid var(--c-border);
  color:var(--c-text-soft);
  font-size:.65rem;
  padding:.45rem .65rem;
  line-height:1;
  border-radius:8px;
  cursor:pointer;
  backdrop-filter:blur(8px);
  letter-spacing:.5px;
  display:flex;
  gap:.35rem;
  align-items:center;
}
.toggle-low-power:active{transform:scale(.95);}
</style>
</head>
<body class="not-loaded">
<button class="toggle-low-power" id="lpToggle" type="button" aria-pressed="false" title="Modo ahorro / efectos">
  ⚡ Efectos
</button>

<div class="night" aria-hidden="true"></div>

<header>
  <h1>Hola Amor.</h1>
  <h2>Te amo muchísimo mi niña linda.</h2>
</header>

<button id="showRamoButton" type="button" aria-haspopup="dialog" aria-expanded="false" aria-label="Abrir opciones de contacto y mostrar ramo">
  Marcame
</button>

<div class="ramo" id="ramo" aria-hidden="true">
  <img
    src="https://github.com/Baque2005/public-files/blob/main/2025/240ac6a013e67096cb3c12002d928aa3.png?raw=true"
    alt="Ramo decorativo de tulipanes rojos"
    loading="lazy"
    decoding="async"
    fetchpriority="low">
</div>

<!-- (Tus flores originales: muestra 1 completa + resto igual que antes) -->
<div class="flowers" id="flowers" aria-hidden="true">
  <!-- Caja debug eliminada -->
  <!-- Flor 1 -->
  <div class="flower flower--1" aria-label="Año 1">
    <div class="flower__leafs">
      <div class="flower__leaf flower__leaf--1"></div>
      <div class="flower__leaf flower__leaf--2"></div>
      <div class="flower__leaf flower__leaf--3"></div>
      <div class="flower__leaf flower__leaf--4"></div>
      <div class="flower__leaf flower__leaf--5"></div>
      <div class="flower__leaf flower__leaf--6"></div>
      <div class="flower__center"></div>
      <div class="flower__light"></div><div class="flower__light"></div>
      <div class="flower__light"></div><div class="flower__light"></div>
    </div>
    <div class="flower__line">
      <div class="flower__line__leaf flower__line__leaf--1"></div>
      <div class="flower__line__leaf flower__line__leaf--2"></div>
      <div class="flower__line__leaf flower__line__leaf--3"></div>
      <div class="flower__line__leaf flower__line__leaf--4"></div>
    </div>
  </div>

  <!-- Flor 2 (Resaltada) -->
  <div class="flower flower--2" aria-label="Año 2">
    <div class="flower__leafs">
      <div class="flower__leaf flower__leaf--1"></div>
      <div class="flower__leaf flower__leaf--2"></div>
      <div class="flower__leaf flower__leaf--3"></div>
      <div class="flower__leaf flower__leaf--4"></div>
      <div class="flower__leaf flower__leaf--5"></div>
      <div class="flower__leaf flower__leaf--6"></div>
      <div class="flower__center"></div>
      <div class="flower__light"></div><div class="flower__light"></div>
      <div class="flower__light"></div><div class="flower__light"></div>
      <div class="flower__light"></div><div class="flower__light"></div>
    </div>
    <div class="flower__line">
      <div class="flower__line__leaf flower__line__leaf--1"></div>
      <div class="flower__line__leaf flower__line__leaf--2"></div>
      <div class="flower__line__leaf flower__line__leaf--3"></div>
      <div class="flower__line__leaf flower__line__leaf--4"></div>
    </div>
  </div>

  <!-- Flor 3 -->
  <div class="flower flower--3" aria-label="Año 3">
    <div class="flower__leafs">
      <div class="flower__leaf flower__leaf--1"></div>
      <div class="flower__leaf flower__leaf--2"></div>
      <div class="flower__leaf flower__leaf--3"></div>
      <div class="flower__leaf flower__leaf--4"></div>
      <div class="flower__leaf flower__leaf--5"></div>
      <div class="flower__leaf flower__leaf--6"></div>
      <div class="flower__center"></div>
      <div class="flower__light"></div><div class="flower__light"></div>
      <div class="flower__light"></div><div class="flower__light"></div>
    </div>
    <div class="flower__line">
      <div class="flower__line__leaf flower__line__leaf--1"></div>
      <div class="flower__line__leaf flower__line__leaf--2"></div>
      <div class="flower__line__leaf flower__line__leaf--3"></div>
      <div class="flower__line__leaf flower__line__leaf--4"></div>
    </div>
  </div>

  <!-- Media flor (5 meses) -->
  <div class="flower flower--half" aria-label="5 meses">
    <div class="flower__leafs">
      <div class="flower__leaf flower__leaf--4"></div>
      <div class="flower__leaf flower__leaf--5"></div>
      <div class="flower__leaf flower__leaf--6"></div>
      <div class="flower__center"></div>
    </div>
    <div class="flower__line">
      <div class="flower__line__leaf flower__line__leaf--1"></div>
      <div class="flower__line__leaf flower__line__leaf--2"></div>
    </div>
  </div>
</div>

<div class="shooting-stars" id="stars" aria-hidden="true"></div>
<div class="mini-toast" id="toast" aria-live="polite"></div>
<main class="visually-hidden" id="mainContent">Contenido decorativo</main>

<script defer>
/* ========== UTILIDADES ========== */
(function(){
  const d=document;
  const $=sel=>d.querySelector(sel);
  const root=d.documentElement;
  /* Altura real móvil */
  function setVH(){
    root.style.setProperty('--vh',(window.innerHeight*0.01)+'px');
  }
  setVH();
  window.addEventListener('resize',()=>requestAnimationFrame(setVH),{passive:true});

  /* Teléfono */
  const RAW_PHONE=(getComputedStyle(root).getPropertyValue('--phone-raw')||'').replace(/["'\s]/g,'');
  const COUNTRY=(getComputedStyle(root).getPropertyValue('--phone-country')||'').replace(/["'\s]/g,'');
  const PHONE_E164=(COUNTRY+RAW_PHONE.replace(/\D/g,''));
  const phoneIsValid=()=>/^52\d{10}$/.test(PHONE_E164);

  /* Elementos */
  const btn=$('#showRamoButton');
  const flowers=$('#flowers');
  const ramo=$('#ramo');
  const toast=$('#toast');
  const lpToggle=$('#lpToggle');

  /* Estado & Flags */
  let lowPower=false;
  let displayed=false;

  /* Heurística hardware simple (reduce efectos en dispositivos lentos) */
  const nav=navigator;
  if((nav.hardwareConcurrency&&nav.hardwareConcurrency<=4) || /Android\s(8|9|10)/i.test(nav.userAgent)){
    lowPower=true;document.body.classList.add('low-power');lpToggle.setAttribute('aria-pressed','true');
  }

  lpToggle.addEventListener('click',()=>{
    lowPower=!lowPower;
    document.body.classList.toggle('low-power',lowPower);
    lpToggle.setAttribute('aria-pressed',String(!lowPower?false:true));
    lpToggle.textContent= lowPower ? '⚡ Efectos' : '✨ Efectos';
    showToast(lowPower?'Modo ahorro activo':'Efectos activados');
  });

  /* Mobile detection */
  const isMobile=()=> (nav.userAgentData && nav.userAgentData.mobile) ||
    /Android|iPhone|iPad|iPod|Windows Phone|Mobi|Silk/i.test(nav.userAgent) ||
    window.matchMedia('(pointer:coarse)').matches;

  /* Toast */
  function showToast(msg,dur=1900){
    if(!toast) return;
    toast.textContent=msg;
    toast.classList.add('show');
    clearTimeout(showToast._t);
    showToast._t=setTimeout(()=>toast.classList.remove('show'),dur);
  }

  /* Stars */
  function spawnStars(n=8){
    if(lowPower) return;
    const wrap=$('#stars'); if(!wrap) return;
    for(let i=0;i<n;i++){
      const s=d.createElement('div');
      s.className='shooting-star';
      const delay=i*2;
      const dur=(2.8+(i%4)*0.35).toFixed(2);
      s.style.top=(5+(i*7)%55)+'%';
      s.style.left='-12%';
      s.style.animationDelay=delay+'s';
      s.style.animationDuration=dur+'s';
      wrap.appendChild(s);
    }
  }
  spawnStars(8);

  /* Confetti adaptativo */
  function confetti(count=110){
    if(lowPower) return;
    if(window.matchMedia('(prefers-reduced-motion:reduce)').matches) return;
    const cvs=d.getElementById('confetti')||(()=>{const c=d.createElement('canvas');c.id='confetti';d.body.appendChild(c);return c;})();
    const ctx=cvs.getContext('2d');
    let w=cvs.width=innerWidth;
    let h=cvs.height=innerHeight;
    const colors=['#ff6b3c','#ffdd57','#ff7a00','#c30f0f','#ff3c3c','#ffd6d6'];
    /* reduce partículas si pantalla pequeña */
    const base=Math.min(count, Math.round((w*h)/14000));
    const parts=Array.from({length:base},()=>({
      x:w/2+(Math.random()*240-120),
      y:h*0.45+(Math.random()*90-45),
      vx:(Math.random()-.5)*6,
      vy:(Math.random()*6)+2,
      r:Math.random()*6+3,
      c:colors[(Math.random()*colors.length)|0],
      rot:Math.random()*360,
      vr:(Math.random()-.5)*11
    }));
    let t=0;
    (function frame(){
      t++;ctx.clearRect(0,0,w,h);
      parts.forEach(p=>{
        p.x+=p.vx; p.y+=p.vy; p.vy+=.13; p.rot+=p.vr;
        ctx.save();ctx.translate(p.x,p.y);ctx.rotate(p.rot*Math.PI/180);
        ctx.fillStyle=p.c;ctx.globalAlpha=Math.max(0,1-(t/120));
        ctx.fillRect(-p.r/2,-p.r/2,p.r,p.r*.55);ctx.restore();
      });
      if(t<120) requestAnimationFrame(frame); else {try{cvs.remove();}catch(e){}}
    })();
  }

  /* Share API (para botón principal largo) */
  async function shareRamo(){
    if(!navigator.share) return false;
    try{await navigator.share({title:'Ramo de Tulipanes',text:'Te mando este ramo con mucho amor ❤️',url:location.href});showToast('Compartido');return true;}catch(_){return false;}
  }

  /* WhatsApp */
  function openWhatsApp(text='Te mando este ramo ❤️'){
    if(!phoneIsValid()){
      showToast('Número inválido');
      console.warn('Teléfono inválido',PHONE_E164);
      return;
    }
    const msg=encodeURIComponent(text);
    const url='https://wa.me/'+PHONE_E164+'?text='+msg;
    if(isMobile()){
      location.href=url;
    }else{
      const w=window.open(url,'_blank','noopener,noreferrer');
      if(!w) location.href=url;
    }
  }

  /* vCard generación & descarga */
  function downloadVCard(){
    if(!phoneIsValid()) return showToast('Número inválido');
    const v=[
      'BEGIN:VCARD',
      'VERSION:3.0',
      'FN:Tulipán Amor',
      'ORG:Ramo Especial',
      'TEL;TYPE=CELL:+'+PHONE_E164,
      'NOTE:Contacto generado desde Ramo de Tulipanes',
      'END:VCARD'
    ].join('\n');
    const blob=new Blob([v],{type:'text/vcard'});
    const a=d.createElement('a');
    a.download='tulipan.vcf';
    a.href=URL.createObjectURL(blob);
    a.click();
    setTimeout(()=>URL.revokeObjectURL(a.href),1200);
    showToast('Contacto listo');
  }

  /* Action Sheet dinámico */
  function ensureSheet(){
    let s=d.querySelector('.action-sheet');
    if(s) return s;
    s=d.createElement('div');
    s.className='action-sheet';
    s.role='dialog';
    s.innerHTML=`
      <div class="action-sheet__title">¿Cómo quieres contactar?</div>
      <div class="action-row">
        <button class="btn-whatsapp" type="button">WhatsApp</button>
        <button class="btn-call" type="button">Llamar</button>
      </div>
      <div class="action-row">
        <button class="btn-neutral" type="button" data-share hidden>Compartir</button>
        <button class="btn-call" type="button" data-copy>Copiar</button>
        <button class="btn-call" type="button" data-vcard>vCard</button>
      </div>
      <div class="action-row">
        <button class="btn-close" type="button">Cerrar</button>
      </div>
    `;
    d.body.appendChild(s);
    const btnWa=s.querySelector('.btn-whatsapp');
    const btnCall=s.querySelector('.btn-call');
    const btnCopy=s.querySelector('[data-copy]');
    const btnClose=s.querySelector('.btn-close');
    const btnVCard=s.querySelector('[data-vcard]');
    const btnShare=s.querySelector('[data-share]');
    if(navigator.share) btnShare.hidden=false;
  btnWa.addEventListener('click',()=>{flourish();openWhatsApp();hideSheet();});
    btnCall.addEventListener('click',()=>{hideSheet();flourish();if(phoneIsValid()) setTimeout(()=>location.href='tel:'+PHONE_E164,340);});
    btnCopy.addEventListener('click',()=>{
      if(!phoneIsValid()) return showToast('Número inválido');
      navigator.clipboard?.writeText('+'+PHONE_E164).then(()=>showToast('Número copiado')).catch(()=>showToast('No se pudo copiar'));
    });
    btnVCard.addEventListener('click',()=>{downloadVCard();});
    btnShare.addEventListener('click',async()=>{ if(!(await shareRamo())) showToast('No disponible');});
    btnClose.addEventListener('click',hideSheet);
    return s;
  }
  function showSheet(){
    const s=ensureSheet();
    requestAnimationFrame(()=>s.classList.add('visible'));
    btn.setAttribute('aria-expanded','true');
  }
  function hideSheet(){
    const s=d.querySelector('.action-sheet');
    if(s) s.classList.remove('visible');
    btn.setAttribute('aria-expanded','false');
  }

  /* Flourish */
  function flourish(){
    if(!displayed){
      ramo?.classList.add('ramo--visible');
      displayed=true;
    }
    flowers?.classList.add('flourish');
    setTimeout(()=>flowers?.classList.remove('flourish'),820);
    confetti(110);
    showToast('Ramo ❤️');
  }

  /* Botón principal */
  let pressTimer;
  btn.addEventListener('pointerdown',()=>{pressTimer=setTimeout(()=>shareRamo(),550);},{passive:true});
  btn.addEventListener('pointerup',()=>clearTimeout(pressTimer),{passive:true});
  btn.addEventListener('click',e=>{
    e.preventDefault();
    flourish();
    if(isMobile()){
      showSheet();
      navigator.vibrate?.(28);
    }else{
  openWhatsApp();
    }
    btn.disabled=true;
    btn.style.opacity='.74';
    setTimeout(()=>{btn.disabled=false;btn.style.opacity='';},1350);
  },{passive:true});

  /* Auto mostrar después de intro */
  setTimeout(()=>ramo?.classList.add('ramo--visible'),2300);

  /* Scroll detection para compactar botón (solo móvil) */
  let lastY=window.scrollY;
  function onScroll(){
    const y=window.scrollY;
    if(Math.abs(y-lastY)<6) return;
    if(y>18) document.body.classList.add('scrolled');
    else document.body.classList.remove('scrolled');
    lastY=y;
  }
  window.addEventListener('scroll',onScroll,{passive:true});

  /* Resize throttle */
  let resizeRAF;
  window.addEventListener('resize',()=>{
    cancelAnimationFrame(resizeRAF);
    resizeRAF=requestAnimationFrame(()=>{
      if(innerHeight<520) btn?.classList.add('btn-compact');
      else btn?.classList.remove('btn-compact');
      if(innerWidth>900) hideSheet();
    });
  },{passive:true});

  /* Oculta action sheet al cambiar visibilidad */
  document.addEventListener('visibilitychange',()=>{if(document.hidden) hideSheet();});

  /* Prevent pinch-zoom glitch on dbltap button */
  btn.addEventListener('touchstart',()=>{}, {passive:true});

  /* Limpieza not-loaded */
  document.body.classList.remove('not-loaded');

  /* (Logs debug removidos) */

  /* Pre-cálculo tardío (idle) */
  (window.requestIdleCallback||function(f){setTimeout(f,120)})(()=>{
    // Potenciales tareas: warm-up, metrics, etc.
  });

  /* Service Worker opcional (descomentar si creas sw.js)
  if('serviceWorker' in navigator){
    navigator.serviceWorker.register('./sw.js').catch(()=>{});
  }
  */
})();
</script>
</body>
</html>
